# 项目文档
## E-R 图

![](./panda_erd.png)

## 技术架构

网站部署在云端, 采用C/S架构. , 因为项目试验成分较大, 为了便于开发修改和调试, 采用基于Python的Django作为后端逻辑处理, 而轻量小巧的sqlite作为数据库, 减少部署和迁移成本.

## 功能模块设计

<!-- 做个图吧 -->

## 关键功能/算法设计

使用Cookies管理用户登录状态. 弥补了HTTP无状态导致无法识别用户登录情况的问题. 围绕Cookies设计的用户.

## 接口设计

<!-- 使用另外两个文档 -->

## 关键数据结构

### User

```python
class User(models.Model):
    username = models.CharField(max_length=50)
    password = models.CharField(max_length=100)
    email = models.EmailField(max_length=50)
    learner_level = models.CharField(max_length=10)
    points = models.IntegerField()
    country = models.CharField(max_length=30)
    age = models.IntegerField()
    portrait_url = models.CharField(max_length=200)
```

### LoginForm

```python
class LoginForm(forms.Form):
    email = forms.CharField(label='邮箱')
    password = forms.CharField(label='密码', widget=forms.PasswordInput())

    def clean_email(self):
        value = self.cleaned_data['email']
        try:
            result_email = User.objects.get(email=value)
        except User.DoesNotExist:
            raise forms.ValidationError(u"该邮箱未注册", code='email invalid')
        return value

    def clean_password(self):
        value = self.cleaned_data['password']
        #这个正则表达式不一定对
        if re.match('^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z!@#$%&*_]{6,20}$', value):
            return value
        else:
            raise forms.ValidationError(u"密码必须由6-20个字母和数字或!@#$%&*_组成", code='password invalid')
```
